(function() {
  var currentScript = document.currentScript;
  
  if (!currentScript) {
    var scripts = document.querySelectorAll('script[src*="lead-loader"]');
    if (scripts.length > 0) {
      currentScript = scripts[scripts.length - 1];
    }
  }
  
  if (!currentScript) {
    var scriptsWithEndpoint = document.querySelectorAll('script[data-endpoint]');
    if (scriptsWithEndpoint.length > 0) {
      currentScript = scriptsWithEndpoint[scriptsWithEndpoint.length - 1];
    }
  }
  
  if (!currentScript) {
    console.error('lead-loader: could not find script element');
    return;
  }
  
  console.log('lead-loader: found script element:', currentScript);
  
  window.__leadPixelConfig = {};
  
  for (var i = 0; i < currentScript.attributes.length; i++) {
    var attr = currentScript.attributes[i];
    if (attr.name.indexOf('data-') === 0) {
      var key = attr.name.replace('data-', '');
      window.__leadPixelConfig[key] = attr.value;
      console.log('lead-loader: captured', key, '=', attr.value);
    }
  }
  
  console.log('lead-loader: final config:', window.__leadPixelConfig);
  
  if (!window.__leadPixelConfig.endpoint) {
    console.error('lead-loader: no endpoint found');
    return;
  }
  
  var script = document.createElement('script');
  script.src = 'https://raw.githubusercontent.com/cmwjr92/Ad-tracking-lead-pixel/main/lead-catcher.js';
  script.defer = true;
  script.onload = function() {
    console.log('lead-loader: lead-catcher.js loaded successfully');
  };
  script.onerror = function() {
    console.error('lead-loader: failed to load lead-catcher.js');
  };
  document.head.appendChild(script);
})();
